# 功能

包括采集数据、解析格式、处理数据、展示数据、生成大屏|报告。

## 1 采集数据collect_data

手写爬虫代码，上传文件到系统后，可以配置定时运行，也可以手工执行。

使用requests采集一些期刊等内容，暂不支持模拟抓取。

- [x] 在根目录下创建软件包scripts，用于存放爬虫脚本。以后往这里面放脚本就行
- [x] 调用爬虫脚本并运行，见tests/test_run_scripts.py
- [ ] 在系统中查看所有的脚本
- [ ] 定时调度爬虫脚本
- [ ] 手工调用爬虫脚本
- [ ] 查看爬虫脚本的运行日志和运行数据

## 2 解析格式parse_data

解析cnki、wos等不同数据源的数据。
数据处理完后，一定要转成标准的模型类型。方便后续处理。

- [x] 在模块parse_data.py中解析不同数据源的不同格式文件
- [x] 解析cnki的题录信息
- [ ] 解析wos
- [ ] 解析cssci

## 3 处理数据do_data

使用pandas 处理数据的合并、去重、补全、导出。
有针对性的创建题录数据、引文数据、全文数据、互联网数据的模型，并创建cube。方便后续使用。

- [ ] 使用pyside6制作可操作的数据操作界面，参考FineBI6
- [x] 题录模型
- [ ] 全文模型
-

## 4 展示数据show_data

根据不同的需求，创建一个个图表组件。比如历年发文量、关键词分布等等。
需要先使用pyecharts定义组件库，然后根据不同的数据模型，去适配不同的图表组件。

- [x] 静态内容存放在文件夹assets中
- [x] 在pyside中展示网页内容，包括html、js、css、image等
- [x] 目前不确定直接读取本地文件，还是需要通过flask访问？决定使用flask，因为很直接很简洁
- [ ] 调用echarts，创建常用的一些图形
- [ ] echarts各个图形的工具箱
- [ ] echarts图形的个性化，类似于CiteSpace

## 5 生成大屏big_screen

使用pyecharts拖拽生成大屏。
支持定时刷新数据。

- [ ] 使用echarts拖拽生成大屏

## 6 生成报告generate_report

把图表复制到word、ppt中，并生成符合格式要求的样式。

- [ ] 生成word文档，并插入echarts的图表

## 7 业务包

根据自己的业务范围，定制属于自己的数据集、组件等。

# 技术相关

vue和echarts整合 https://www.bilibili.com/video/BV1cY411L7t6/

## 使用QWebWidget显示本地网页

```
    channel = Test()
    handlers = Handlers()
    channel.registerObject('py', handlers)
    handlers.page.setWebChannel(channel)

    with open("assets/index.html", "rb") as f:
        handlers.view.setHtml(f.read().decode())
    handlers.view.show()
```

## 使用coverage生成测试报告

创建一个py文件，然后运行即可。

```python
import coverage
import pytest

# 实例化对象
cov = coverage.coverage()
cov.start()

# 测试
pytest.main(["-v", "-s"])

# 结束分析
cov.stop()

# 结果保存
cov.save()

# 命令行模式展示结果,并展示未执行代码具体行数，用于测试结果查看使用
cov.report(show_missing=True)

# 生成HTML覆盖率结果报告
cov.html_report(directory="res_html")
```